<div id="toc-and-metadata">
  <h3 class="obscure">Table of contents</h3> 

  <img id="icon-list-view" src="images/icon-list-view-active.png" alt="">
  <img id="icon-gallery-view" src="images/icon-gallery-view-inactive.png" alt="">

  <ol id="toc">
    <% @purl.deliverable_files.each do |deliverable_file| %>
      <%
        img_files = Array.new
	      img_id = get_jp2_id(deliverable_file.filename.to_s) 
	    	    
	      if !img_id.nil? and !img_id.empty? 
	        img_files = img_files.push(deliverable_file) 
	      else 
	        if deliverable_file.sub_resources.length > 0 
	          img_files.concat(deliverable_file.sub_resources) 
	        end 
        end 	
      %>
						
			<% img_files.each do |deliverable_file| %>
			  <% img_id = get_jp2_id(deliverable_file.filename.to_s) %>				
			
		    <% if !img_id.nil? and !img_id.empty? %>
			    <% base_url = get_img_base_url(deliverable_file) %>
				
		      <li>
		        <a id="<%= img_id %>" href="#" class="item-header">            
			        <%= image_tag "#{base_url}_square.jpg", :id => "square-img-#{img_id}", :class => "sq-thumbnail-img", :alt => "" %>
			        <div class="img-item-label-container"><%= get_file_label(deliverable_file) %></div>
		        </a>
		        <div id="data-links-<%= img_id %>" class="img-options" style="display: none;">
		          <ul>
			          <li class="img-title">Available <br/> sizes:</li>
			          <li>
			            <a id="small-<%= img_id %>" href="#" title="View at 294 x 368 pixels"><span class="obscure">View the </span>small<span class="obscure"> size of image 1</span></a>&nbsp;
			            <a id="small-download-<%= img_id %>" href="<%= base_url %>_small.jpg?action=download" title="Download <%= img_id %>_small.jpg"><span class="obscure">Download the small size of image 1</span><img src="images/icon-download.png" alt=""/></a> <br/>
			            <span id="small-size-<%= img_id %>" class="img-size"></span>
			          </li>
			          <li>
			            <a id="medium-<%= img_id %>" href="#" title="View at 587 x 736 pixels"><span class="obscure">View the </span>medium<span class="obscure"> size of image 1</span></a>&nbsp;
			            <a id="medium-download-<%= img_id %>" href="<%= base_url %>_medium.jpg?action=download" title="Download <%= img_id %>_medium.jpg"><span class="obscure">Download the medium size of image 1</span><img src="images/icon-download.png" alt=""/></a> <br/>
			            <span id="medium-size-<%= img_id %>" class="img-size"></span>
			          </li>
			          <li>
			            <a id="large-<%= img_id %>" href="#" title="View at 1174 x 1472 pixels"><span class="obscure">View the </span>large<span class="obscure"> size of image 1</span></a>&nbsp;
			            <a id="large-download-<%= img_id %>" href="<%= base_url %>_large.jpg?action=download" title="Download <%= img_id %>_large.jpg"><span class="obscure">Download the large size of image 1</span><img src="images/icon-download.png" alt=""/></a> <br/>
			            <span id="large-size-<%= img_id %>" class="img-size"></span>
			          </li>
			          <li>
			            <a id="zoom-<%= img_id %>" href="#" title="Zoom View">zoom <br/> view<span class="obscure"> of image 1</span></a>                
			          </li>
		          </ul>
		        </div>
		        <div id="full-img-<%= img_id %>" class="full-img-box" style="display: none;">
			        <% if @purl.pid == "dm907qj6498" %>
			          <img src="<%= STACKS_URL.gsub /\-test/i,'' %>/image/<%= @purl.pid %>/<%= img_id %>?w=325" alt="" />
			        <% else %>
		            <img src="<%= STACKS_URL %>/image/<%= @purl.pid %>/<%= img_id %>?w=325" alt="" />
		          <% end %>
		        </div>
		      </li>
	      <% end %>          
	    <% end %>	
    <% end %>
  </ol>
  
  <ol id="gallery" style="display:none;">
    <% @purl.deliverable_files.each do |deliverable_file| %>
      <% img_id = get_jp2_id(deliverable_file.filename.to_s) %>				

	    <% if !img_id.nil? and !img_id.empty? %>
		    <% base_url = get_img_base_url(deliverable_file) %>
				
	      <li>
		      <div class="img-block">
			       <a href="javascript:showImg('zoom-<%= img_id %>', '<%= img_id %>');">
			        <% if @purl.pid == "dm907qj6498" %>
			          <img src="<%= STACKS_URL.gsub /\-test/i,'' %>/image/<%= @purl.pid %>/<%= img_id %>?w=240&h=240" alt="" />
			        <% else %>
		            <img src="<%= STACKS_URL %>/image/<%= @purl.pid %>/<%= img_id %>?w=240&h=240" alt="" /> 
		          <% end %>
	          </a> 
	        </div>
	        <div class="img-group-nav">
		      </div>
	        <div class="img-group-label-container"><%= get_file_label(deliverable_file) %></div>
	      </li>                

	    <% elsif deliverable_file.sub_resources.length > 0 %>
	      <% 
	        img_files = Array.new 
	        sno = 1
	        sequence = deliverable_file.sequence.to_s
	        img_files.concat(deliverable_file.sub_resources) 	        
	      %>
	
	      <li>
		
				<% img_files.each do |img_file| %>
				  <% img_id = get_jp2_id(img_file.filename.to_s) %>				

				  <% if !img_id.nil? and !img_id.empty? %>
				    <% base_url = get_img_base_url(img_file) %>
				    <% display = sno == 1 ? "inline" : "none" %> 
				
				    <div id="<%= @purl.pid.to_s + '_seq_' + sequence + '_img_' + sno.to_s %>" style="display: <%= display %>;">
						  <div class="img-block">
						   <a href="javascript:showImg('zoom-<%= img_id %>', '<%= img_id %>');">
						     <% if @purl.pid == "dm907qj6498" %>
						       <img src="<%= STACKS_URL.gsub /\-test/i,'' %>/image/<%= @purl.pid %>/<%= img_id %>?w=240&h=240" alt="" />
						     <% else %>
						        <img src="<%= STACKS_URL %>/image/<%= @purl.pid %>/<%= img_id %>?w=240&h=240" alt="" /> 
						      <% end %>
					      </a> 
					    </div>
					    <div class="img-group-nav">
						    <a href="javascript:showGalleryImg('<%= sno %>', '<%= img_files.length %>', '<%= @purl.pid %>', '<%= sequence %>', -1);"><img class="gallery-img-nav-icon" src="images/gallery-img-prev.png"></a>						
						    <%= sno %> of <%= img_files.length %>
					      <a href="javascript:showGalleryImg('<%= sno %>', '<%= img_files.length %>', '<%= @purl.pid %>', '<%= sequence %>', 1);"><img class="gallery-img-nav-icon" src="images/gallery-img-next.png"></a>
						  </div>
					    <div class="img-group-label-container"><%= get_file_label(img_file) %></div>
				    </div>
				    <% sno += 1 %> 
		      <% end %>
		    <% end %>
      </li>                				
	
	    <% end %>

    <% end %>
	</ol>

  <div id="rights-metadata">
    <h3 class="obscure">Links &amp; rights</h3> 

    <dl>
		  <% if not(@purl.cclicense_symbol.nil? or @purl.cclicense_symbol.empty?) %>
	      <dt>Rights :</dt>
	      <dd>
				  <% if @purl.cclicense_symbol.to_s.eql? 'by' %>
				    <div class="cc_by">
					  <a href="http://creativecommons.org/licenses/by/3.0/" _target="blank">This work is licensed under a Creative Commons Attribution 3.0 Unported License</a>
					</div>
				  <% elsif @purl.cclicense_symbol.to_s.eql? 'by-sa' %>
				    <div class="cc_by_sa">
					    <a href="http://creativecommons.org/licenses/by-sa/3.0/" _target="blank">This work is licensed under a Creative Commons Attribution-Share Alike 3.0 Unported License</a>
				    </div>
				  <% elsif @purl.cclicense_symbol.to_s.eql? 'by-nd' %>
				    <div class="cc_by_nd">
					    <a href="http://creativecommons.org/licenses/by-nd/3.0/" _target="blank">This work is licensed under a Creative Commons Attribution-No Derivative Works 3.0 Unported License</a>
				    </div>
				  <% elsif @purl.cclicense_symbol.to_s.eql? 'by-nc' %>
				    <div class="cc_by_nc">
					    <a href="http://creativecommons.org/licenses/by-nc/3.0/" _target="blank">This work is licensed under a Creative Commons Attribution-Noncommercial 3.0 Unported License</a>
				    </div>
				  <% elsif @purl.cclicense_symbol.to_s.eql? 'by-nc-sa' %>
				    <div class="cc_by_nc_sa">
					    <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" _target="blank">This work is licensed under a Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License</a>
				    </div>
				  <% elsif @purl.cclicense_symbol.to_s.eql? 'by-nc-nd' %>
				    <div class="cc_by_nc_nd">
					    <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" _target="blank">This work is licensed under a Creative Commons Attribution-Noncommercial-No Derivative Works 3.0 Unported License</a>
				    </div>
				  <% else %>
					   <%= @purl.cclicensetype.to_s %>
				  <% end %>
		    </dd>
			<% end %>	

	    <%= print_field_value("use_and_reproduction_stmt", "Use and Reproduction") %>	    
    </dl>          

  </div>

</div>
