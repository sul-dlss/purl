# frozen_string_literal: true

require 'rails_helper'

RSpec.describe AccessComponent, type: :component do
  subject(:component) { described_class.new(version:) }

  let(:purl) { Purl.new(id: druid) }
  let(:druid) { 'bb737zp0787' }
  let(:version) { purl.version(:head) }

  before do
    render_inline(component)
  end

  it 'draws the access information' do
    expect(page).to have_css 'h2', text: 'Access conditions'
    expect(page).to have_content 'Use and Reproduction'
    expect(page).to have_content 'Property rights reside with the repository. Literary rights reside with the creators'
    expect(page).to have_content 'Copyright © Stanford University. All Rights Reserved.'
  end

  context 'when use_and_reproduction has line breaks and urls' do
    let(:version) { instance_double(PurlVersion, cocina_display:) }
    let(:cocina_display) { instance_double(CocinaDisplay::CocinaRecord, use_and_reproduction:, license_description: '', copyright: '') }
    let(:use_and_reproduction) do # from https://purl.stanford.edu/sn467ty4143
      "Data Use Agreement (DUA)\r\n\r\nApril 1, 2023\r\n\r\nI. INTRODUCTION:\r\n\r\nStanford University (“Licensee”) has licensed Planet Labs (“Data”) from Planet Labs PBC. (“Licensor”).\r\n\r\nII. END-USER ACKNOWLEDGMENT:\r\n\r\nBefore Accessing or Using the Data, You MUST:\r\n(i) Read and accept these Terms & Conditions, &\r\n(ii) Acknowledge that you have read, understand, & will comply with these Terms & Conditions when you log in to download and/or use any of the Data.\r\n\r\nFailure To Comply with these terms and conditions will result in the termination of this DUA.\r\n\r\nIf you do not accept the terms & conditions herein, then you may not access or use the Data.\r\n\r\nIf you have any questions, then please contact: Stace Maples, stacemaples@stanford.edu\r\n\r\nIII. STANFORD UNIVERSITY LIBRARY (SUL) REQUIREMENTS:\r\n\r\nWho qualifies as a Stanford Authorized User?\r\nStanford faculty, staff, enrolled students, and researchers officially affiliated with Stanford University, who are engaged in academic and policy related research, qualify as Stanford Authorized Users.\r\n\r\nWhat are the permitted uses?\r\nAuthorized Users may use the Data for internal, academic, and non-commercial research purposes.\r\n\r\nAuthorized Users may have and use the Data on an organization-wide basis, provided that all individuals accessing the Data adhere to the terms and conditions of this DUA.\r\n\r\nAuthorized Users acknowledge that the Data constitutes valuable proprietary information of Licensor, and as such, Authorized Users shall take all reasonable precautions to prevent unauthorized third parties or persons from accessing or using the Data including, without limitation, such precautions as Licensee would take to protect its own proprietary software, hardware, or information.\r\n\r\nIf I have any additional needs beyond what is expressly stated in this DUA (such as granting access to Data to external parties for peer review, publication, and replication), then I will consult with SUL and obtain the proper permission beforehand.\r\n\r\nWhat are the Restrictions on usage?\r\nUnless express permission is granted elsewhere in this DUA, Authorized Users will not allow access to the Data to anyone who is not a Stanford Authorized User.\r\n\r\nI will not directly or indirectly distribute, sell, make available, or permit third parties to access any Data. I will promptly notify the Stanford Libraries of any unauthorized release, disclosure, or use of the Data.\r\n\r\nWhat about Attribution?\r\nAuthorized Users agree to list Licensor as the source for the Data on all derivative works (including research papers, maps, reports, displays, and applications) where the Data is used.\r\n\r\nWhat about Intellectual Property?\r\nAuthorized Users acknowledge that the Data is and shall remain the property of Licensor and that no ownership rights are conveyed to Authorized Users through this DUA.\r\n\r\nAuthorized Users will take no action to infringe on the rights of Licensor therein.\r\n\r\nWhat do I need to know about Data quality?\r\nI understand that all Data is provided on an “as is” basis. Licensor and Licensee make no warranty as to the completeness or accuracy of the content and are not liable for any losses or damages that result from use of the Data.\r\n\r\nWhat do I need to know about Data Security Standards?\r\nThe Data must be used on a server or on a computer that meets with Stanford University’s information security standards: https://uit.stanford.edu/guide/securitystandards, https://uit.stanford.edu/guide/riskclassifications, & https://adminguide.stanford.edu/chapter-6/subchapter-2/policy-6-2-1\r\n\r\nCan this DUA be Terminated?\r\nAuthorized User's access to the Data may be terminated if any of the terms and conditions of this DUA are violated.\r\n\r\nWhat happens when my affiliation with Stanford University ends?\r\nShould my affiliation with Stanford University end and I am no longer considered an Authorized User, or I receive a written request of SUL, I shall:\r\nReturn to SUL all Data and all copies,\r\nErase or destroy all such Data contained within computer memory or data storage apparatus, &\r\nCertify to SUL that I have complied with this Section.\r\n\r\nWhat if there is a conflict between this DUA and the License Agreement?\r\nI understand that use of the Data is governed by a License between Licensor and Licensee. To the extent that there is any conflict between this DUA and the governing License, the License shall govern. If I have any questions about permitted uses or specific terms of the License, I will consult SUL.\r\n\r\nIV. ADDITIONAL REQUIREMENTS - SPECIFIC TO GOVERNING LICENSE AGREEMENT:\r\n\r\nPer the governing Agreement, you are expressly acknowledging that if you violate the terms of the Agreement:\r\nYour access will be terminated.\r\nYou will be required to delete and destroy any data downloaded from the Planet API.\r\nYou may be personally liable for any misuse of this data, inducing without limitation, any reselling of data or transfer of data to third parties\r\n\r\nV. Attestation:\r\n\r\nBy accessing this data, I acknowledge that I have read and understand this DUA and will comply with all terms and conditions therein. My right to access and use of the data is subject to immediate suspension if there is any evidence of misuse of the data in any way. I understand that violating these standards may result in permanent exclusion from access to SUL resources, that written notification will be delivered to the University documenting the nature of the violation, and that the University may impose additional penalties upon me, as within their legal authority and rights governed by Stanford University policy.\r\n\r\nUser agrees that, where applicable, content will not be used to identify or to otherwise infringe the privacy or confidentiality rights of individuals. Content distributed via the Stanford Digital Repository may be subject to additional license and use restrictions applied by the depositor." # rubocop:disable Layout/LineLength
    end

    it 'draws them' do
      expect(page).to have_css 'br', count: 18
      expect(page).to have_link 'stacemaples@stanford.edu'
      expect(page).to have_link 'https://adminguide.stanford.edu/chapter-6/subchapter-2/policy-6-2-1'
    end
  end
end
